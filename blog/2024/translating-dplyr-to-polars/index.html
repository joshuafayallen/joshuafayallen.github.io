<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This is me learning the snake language">

<title>Translating What I know in the tidyverse to polars:</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../CV/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jallen108@gsu.edu"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/joshuallen17"> <i class="bi bi-twitter" role="img" aria-label="twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/joshuafayallen"> <i class="bi bi-github" role="img" aria-label="github">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-basics" id="toc-the-basics" class="nav-link active" data-scroll-target="#the-basics">The Basics</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">Filter</a>
  <ul class="collapse">
  <li><a href="#r-6" id="toc-r-6" class="nav-link" data-scroll-target="#r-6">R</a></li>
  <li><a href="#python-6" id="toc-python-6" class="nav-link" data-scroll-target="#python-6">Python</a></li>
  </ul></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select">Select</a>
  <ul class="collapse">
  <li><a href="#using-selectors" id="toc-using-selectors" class="nav-link" data-scroll-target="#using-selectors">Using Selectors</a></li>
  </ul></li>
  <li><a href="#renaming-columns" id="toc-renaming-columns" class="nav-link" data-scroll-target="#renaming-columns">Renaming Columns</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate">Mutate</a>
  <ul class="collapse">
  <li><a href="#ifelse-equivalents" id="toc-ifelse-equivalents" class="nav-link" data-scroll-target="#ifelse-equivalents">ifelse equivalents</a></li>
  <li><a href="#converting-columns-to-appropriate-type" id="toc-converting-columns-to-appropriate-type" class="nav-link" data-scroll-target="#converting-columns-to-appropriate-type">Converting columns to appropriate type</a></li>
  <li><a href="#group-by-and-summarize" id="toc-group-by-and-summarize" class="nav-link" data-scroll-target="#group-by-and-summarize">Group by and summarize</a>
  <ul class="collapse">
  <li><a href="#across" id="toc-across" class="nav-link" data-scroll-target="#across">across</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#joins-in-polars" id="toc-joins-in-polars" class="nav-link" data-scroll-target="#joins-in-polars">Joins in Polars</a></li>
  <li><a href="#binding-rows" id="toc-binding-rows" class="nav-link" data-scroll-target="#binding-rows">Binding Rows</a></li>
  <li><a href="#tidyr" id="toc-tidyr" class="nav-link" data-scroll-target="#tidyr">Tidyr</a>
  <ul class="collapse">
  <li><a href="#pivots-of-all-shapes" id="toc-pivots-of-all-shapes" class="nav-link" data-scroll-target="#pivots-of-all-shapes">Pivots of all shapes</a>
  <ul class="collapse">
  <li><a href="#using-selectors-in-pivot-longer" id="toc-using-selectors-in-pivot-longer" class="nav-link" data-scroll-target="#using-selectors-in-pivot-longer">Using selectors in pivot longer</a></li>
  </ul></li>
  <li><a href="#unnest" id="toc-unnest" class="nav-link" data-scroll-target="#unnest">Unnest</a></li>
  </ul></li>
  <li><a href="#plotting-data" id="toc-plotting-data" class="nav-link" data-scroll-target="#plotting-data">Plotting data</a>
  <ul class="collapse">
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms">Histograms</a></li>
  <li><a href="#scatter-plots" id="toc-scatter-plots" class="nav-link" data-scroll-target="#scatter-plots">Scatter Plots</a></li>
  <li><a href="#adjusting-legend" id="toc-adjusting-legend" class="nav-link" data-scroll-target="#adjusting-legend">Adjusting legend</a></li>
  <li><a href="#adding-informative-labels" id="toc-adding-informative-labels" class="nav-link" data-scroll-target="#adding-informative-labels">Adding Informative Labels</a></li>
  <li><a href="#facet-wrap" id="toc-facet-wrap" class="nav-link" data-scroll-target="#facet-wrap">Facet Wrap</a></li>
  </ul></li>
  <li><a href="#modeling" id="toc-modeling" class="nav-link" data-scroll-target="#modeling">Modeling</a></li>
  <li><a href="#misc-stuff-that-are-usefull-but-not-neccessarilly-useful-all-the-time" id="toc-misc-stuff-that-are-usefull-but-not-neccessarilly-useful-all-the-time" class="nav-link" data-scroll-target="#misc-stuff-that-are-usefull-but-not-neccessarilly-useful-all-the-time">Misc stuff that are usefull but not neccessarilly useful all the time</a>
  <ul class="collapse">
  <li><a href="#slicefamily" id="toc-slicefamily" class="nav-link" data-scroll-target="#slicefamily">Slice(family)</a></li>
  <li><a href="#slice-sample" id="toc-slice-sample" class="nav-link" data-scroll-target="#slice-sample">Slice Sample</a></li>
  <li><a href="#batch-renaming" id="toc-batch-renaming" class="nav-link" data-scroll-target="#batch-renaming">Batch renaming</a></li>
  <li><a href="#make-a-column-into-a-vector" id="toc-make-a-column-into-a-vector" class="nav-link" data-scroll-target="#make-a-column-into-a-vector">Make a column into a vector</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Translating What I know in the tidyverse to polars:</h1>
  <div class="quarto-categories">
    <div class="quarto-category">r</div>
    <div class="quarto-category">tidyverse</div>
    <div class="quarto-category">python</div>
    <div class="quarto-category">polars</div>
  </div>
  </div>

<div>
  <div class="description">
    This is me learning the snake language
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Jul 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>I suppose at some point it is good to become more well versed in lots of tools. I have been python curious for about a year or so and I think it is important to use the tool best suited for the task. Also sometimes it is important to get out of your comfort zone. I am definitely somebody who is very comfortable in R and the <code>tidyverse</code> and use it for a lot of stuff. I have heard lots of ravings about polars specifically about its speed and similarities in intuition with the tidyverse. So I thought I would have a collection of code for myself and the people of the internet to reference.</p>
<p>Just a disclaimer. This is really just me working through the similarities and is going to be based on the <a href="https://blog.tidy-intelligence.com/posts/dplyr-vs-polars/">tidyintelligence’s blog post</a>, <a href="https://robertmitchellv.com/blog/2022-07-r-python-side-by-side/r-python-side-by-side.html">Robert Mitchell’s blog post</a>, and <a href="https://www.emilyriederer.com/post/py-rgo-polars/">Emily Rieder’s blog post</a>. In all honesty, this is just for me to smash them together to have a one-stop shop for myself. If you found this post over these resources I highly recommend you check out these resources.</p>
<section id="the-basics" class="level1">
<h1>The Basics</h1>
<p>As always we should load in the respective packages we are going to use.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> palmerpenguins <span class="im">import</span> load_penguins</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> load_penguins().pipe(pl.from_pandas)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>pl.Config(tbl_rows <span class="op">=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> pl.read_csv(<span class="st">'penguins.csv'</span>).with_columns(cs.starts_with(<span class="st">'bill'</span>).cast(pl.Float64, strict <span class="op">=</span> <span class="va">False</span>)).with_columns(cs.starts_with(<span class="st">"flipper"</span>).cast(pl.Float64, strict <span class="op">=</span> <span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Okay so far nothing too crazy! The main difference in loading in the packages and the data we are using is really just that to get with our familiar <code>starts_with</code> friends from the tidyverse we have to add <code>polars.selectors</code> and change some defaults. Lots of the time we would like to see the top and bottom portion and the column types. In <code>R</code> this is just our <code>head</code>, <code>tail</code>, <code>glimpse/str</code> in python it should be broadly similar.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(penguins) <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">island</th>
<th style="text-align: right;">bill_length_mm</th>
<th style="text-align: right;">bill_depth_mm</th>
<th style="text-align: right;">flipper_length_mm</th>
<th style="text-align: right;">body_mass_g</th>
<th style="text-align: left;">sex</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.1</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">3750</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.5</td>
<td style="text-align: right;">17.4</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">3800</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">40.3</td>
<td style="text-align: right;">18.0</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">3250</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">36.7</td>
<td style="text-align: right;">19.3</td>
<td style="text-align: right;">193</td>
<td style="text-align: right;">3450</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.3</td>
<td style="text-align: right;">20.6</td>
<td style="text-align: right;">190</td>
<td style="text-align: right;">3650</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">2007</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>penguins.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 8)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>39.1</td>
<td>18.7</td>
<td>181.0</td>
<td>"3750"</td>
<td>"male"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>39.5</td>
<td>17.4</td>
<td>186.0</td>
<td>"3800"</td>
<td>"female"</td>
<td>2007</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>40.3</td>
<td>18.0</td>
<td>195.0</td>
<td>"3250"</td>
<td>"female"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>"NA"</td>
<td>"NA"</td>
<td>2007</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>36.7</td>
<td>19.3</td>
<td>193.0</td>
<td>"3450"</td>
<td>"female"</td>
<td>2007</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>So one big difference for me is that when you are doing things with objects instead of feeding them directly to head you are doing <code>object_name.head()</code> which I suppose will take some time to get used to. I suppose for completeness we should look at the glimpse equivalent since I use that function all the time</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 344
Columns: 8
$ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…
$ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…
$ bill_length_mm    &lt;dbl&gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …
$ bill_depth_mm     &lt;dbl&gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …
$ flipper_length_mm &lt;int&gt; 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…
$ body_mass_g       &lt;int&gt; 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …
$ sex               &lt;fct&gt; male, female, female, NA, female, male, female, male…
$ year              &lt;int&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>penguins.glimpse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 344
Columns: 8
$ species           &lt;str&gt; 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie'
$ island            &lt;str&gt; 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen'
$ bill_length_mm    &lt;f64&gt; 39.1, 39.5, 40.3, None, 36.7, 39.3, 38.9, 39.2, 34.1, 42.0
$ bill_depth_mm     &lt;f64&gt; 18.7, 17.4, 18.0, None, 19.3, 20.6, 17.8, 19.6, 18.1, 20.2
$ flipper_length_mm &lt;f64&gt; 181.0, 186.0, 195.0, None, 193.0, 190.0, 181.0, 195.0, 193.0, 190.0
$ body_mass_g       &lt;str&gt; '3750', '3800', '3250', 'NA', '3450', '3650', '3625', '4675', '3475', '4250'
$ sex               &lt;str&gt; 'male', 'female', 'female', 'NA', 'female', 'male', 'female', 'male', 'NA', 'NA'
$ year              &lt;i64&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Okay! What is cool for me so far about polars is that it is more getting used to the whole <code>.</code> thing.</p>
</section>
<section id="filter" class="level1">
<h1>Filter</h1>
<p>One of the key things in data cleaning or working with data is working with observations that fit some criteria! In this case, lets just grab all the rows that have Adelie penguins and are above the mean body mass</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Adelie"</span>, body_mass_g <span class="sc">&gt;</span> <span class="fu">mean</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 8
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.2          19.6               195        4675
 2 Adelie  Torgersen           42            20.2               190        4250
 3 Adelie  Torgersen           34.6          21.1               198        4400
 4 Adelie  Torgersen           42.5          20.7               197        4500
 5 Adelie  Dream               39.8          19.1               184        4650
 6 Adelie  Dream               44.1          19.7               196        4400
 7 Adelie  Dream               39.6          18.8               190        4600
 8 Adelie  Biscoe              40.1          18.9               188        4300
 9 Adelie  Biscoe              41.3          21.1               195        4400
10 Adelie  Torgersen           41.8          19.4               198        4450
# ℹ 15 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>penguins.<span class="bu">filter</span>(pl.col(<span class="st">"species"</span>) <span class="op">==</span> <span class="st">"Adelie"</span> <span class="op">&amp;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                pl.col(<span class="st">"body_mass_g"</span> <span class="op">&gt;</span> mean(pl.col(<span class="st">"body_mass_g"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NameError: name 'mean' is not defined</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This is my first attempt at it! It looks like the problem I am running into is that Python does not have a <code>base python</code> where a function like mean is defined.</p>
<p>After fiddling with it for some time it turns out the filter call is actually not correctly defined either! So before each filter option, you need to add a set of <code>()</code></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Adelie"</span>, body_mass_g <span class="sc">&gt;</span> <span class="fu">mean</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 8
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.2          19.6               195        4675
 2 Adelie  Torgersen           42            20.2               190        4250
 3 Adelie  Torgersen           34.6          21.1               198        4400
 4 Adelie  Torgersen           42.5          20.7               197        4500
 5 Adelie  Dream               39.8          19.1               184        4650
 6 Adelie  Dream               44.1          19.7               196        4400
 7 Adelie  Dream               39.6          18.8               190        4600
 8 Adelie  Biscoe              40.1          18.9               188        4300
 9 Adelie  Biscoe              41.3          21.1               195        4400
10 Adelie  Torgersen           41.8          19.4               198        4450
# ℹ 15 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>penguins.<span class="bu">filter</span>((pl.col(<span class="st">"species"</span>) <span class="op">==</span> <span class="st">"Adelie"</span>) <span class="op">&amp;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                (pl.col(<span class="st">"body_mass_g"</span>) <span class="op">&gt;</span> pl.col(<span class="st">"body_mass_g"</span>).mean()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (0, 8)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Nobody said this was going to be pretty or seamless! One other thing to get used to is that we are not going to be using something crazy like <code>%in%</code> for set membership! We use <code>is_in</code></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Gentoo"</span>, <span class="st">"Chinstrap"</span>),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       bill_depth_mm <span class="sc">&gt;</span> <span class="fu">median</span>(bill_depth_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 8
   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Chinstrap Dream            46.5          17.9               192        3500
 2 Chinstrap Dream            50            19.5               196        3900
 3 Chinstrap Dream            51.3          19.2               193        3650
 4 Chinstrap Dream            45.4          18.7               188        3525
 5 Chinstrap Dream            52.7          19.8               197        3725
 6 Chinstrap Dream            45.2          17.8               198        3950
 7 Chinstrap Dream            46.1          18.2               178        3250
 8 Chinstrap Dream            51.3          18.2               197        3750
 9 Chinstrap Dream            46            18.9               195        4150
10 Chinstrap Dream            51.3          19.9               198        3700
# ℹ 42 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>penguins.<span class="bu">filter</span>((pl.col(<span class="st">"species"</span>).is_in([<span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span>])) <span class="op">&amp;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                (pl.col(<span class="st">"bill_depth_mm"</span>) <span class="op">&gt;</span> pl.col(<span class="st">"bill_depth_mm"</span>).median()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (52, 8)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>46.5</td>
<td>17.9</td>
<td>192.0</td>
<td>"3500"</td>
<td>"female"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>50.0</td>
<td>19.5</td>
<td>196.0</td>
<td>"3900"</td>
<td>"male"</td>
<td>2007</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>51.3</td>
<td>19.2</td>
<td>193.0</td>
<td>"3650"</td>
<td>"male"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>45.4</td>
<td>18.7</td>
<td>188.0</td>
<td>"3525"</td>
<td>"female"</td>
<td>2007</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>52.7</td>
<td>19.8</td>
<td>197.0</td>
<td>"3725"</td>
<td>"male"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>55.8</td>
<td>19.8</td>
<td>207.0</td>
<td>"4000"</td>
<td>"male"</td>
<td>2009</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>43.5</td>
<td>18.1</td>
<td>202.0</td>
<td>"3400"</td>
<td>"female"</td>
<td>2009</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>49.6</td>
<td>18.2</td>
<td>193.0</td>
<td>"3775"</td>
<td>"male"</td>
<td>2009</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>50.8</td>
<td>19.0</td>
<td>210.0</td>
<td>"4100"</td>
<td>"male"</td>
<td>2009</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>50.2</td>
<td>18.7</td>
<td>198.0</td>
<td>"3775"</td>
<td>"female"</td>
<td>2009</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>One other thing that is weird (to me at least) is that you do not have to set the polars functions to remove NA’s by default! Which I suppose is nice? But feels a bit wrong and weird to me as an R user.</p>
<p>A common case that you run into is that maybe there are a whole bunch of things or one thing that you don’t want. In R you would just add the neccessary negations ahead of what you want. In polars it is a little different if you want to exclude values from a set.</p>
<p>::{.panel-tabset}</p>
<section id="r-6" class="level2">
<h2 class="anchored" data-anchor-id="r-6">R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="sc">!</span>species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Gentoo"</span>, <span class="st">"Chinstrap"</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>       island <span class="sc">!=</span> <span class="st">"Dream"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 96 × 8
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7               181        3750
 2 Adelie  Torgersen           39.5          17.4               186        3800
 3 Adelie  Torgersen           40.3          18                 195        3250
 4 Adelie  Torgersen           NA            NA                  NA          NA
 5 Adelie  Torgersen           36.7          19.3               193        3450
 6 Adelie  Torgersen           39.3          20.6               190        3650
 7 Adelie  Torgersen           38.9          17.8               181        3625
 8 Adelie  Torgersen           39.2          19.6               195        4675
 9 Adelie  Torgersen           34.1          18.1               193        3475
10 Adelie  Torgersen           42            20.2               190        4250
# ℹ 86 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="python-6" class="level2">
<h2 class="anchored" data-anchor-id="python-6">Python</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>penguins.<span class="bu">filter</span>((pl.col(<span class="st">"species"</span>).is_in([<span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span>]).not_()) <span class="op">&amp;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                (pl.col(<span class="st">"island"</span>) <span class="op">!=</span> <span class="st">'Dream'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (96, 8)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>39.1</td>
<td>18.7</td>
<td>181.0</td>
<td>"3750"</td>
<td>"male"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>39.5</td>
<td>17.4</td>
<td>186.0</td>
<td>"3800"</td>
<td>"female"</td>
<td>2007</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>40.3</td>
<td>18.0</td>
<td>195.0</td>
<td>"3250"</td>
<td>"female"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>"NA"</td>
<td>"NA"</td>
<td>2007</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>36.7</td>
<td>19.3</td>
<td>193.0</td>
<td>"3450"</td>
<td>"female"</td>
<td>2007</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>41.5</td>
<td>18.3</td>
<td>195.0</td>
<td>"4300"</td>
<td>"male"</td>
<td>2009</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>39.0</td>
<td>17.1</td>
<td>191.0</td>
<td>"3050"</td>
<td>"female"</td>
<td>2009</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>44.1</td>
<td>18.0</td>
<td>210.0</td>
<td>"4000"</td>
<td>"male"</td>
<td>2009</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>38.5</td>
<td>17.9</td>
<td>190.0</td>
<td>"3325"</td>
<td>"female"</td>
<td>2009</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>43.1</td>
<td>19.2</td>
<td>197.0</td>
<td>"3500"</td>
<td>"male"</td>
<td>2009</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>:::</p>
</section>
</section>
<section id="select" class="level1">
<h1>Select</h1>
<p>In some cases, we have a dataset with extraneous columns we do not care for. Let’s do a really extreme example</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(island)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 1
   island   
   &lt;fct&gt;    
 1 Torgersen
 2 Torgersen
 3 Torgersen
 4 Torgersen
 5 Torgersen
 6 Torgersen
 7 Torgersen
 8 Torgersen
 9 Torgersen
10 Torgersen
# ℹ 334 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>penguins.select((pl.col(<span class="st">"island"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (344, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">island</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Torgersen"</td>
</tr>
<tr class="even">
<td>"Torgersen"</td>
</tr>
<tr class="odd">
<td>"Torgersen"</td>
</tr>
<tr class="even">
<td>"Torgersen"</td>
</tr>
<tr class="odd">
<td>"Torgersen"</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>"Dream"</td>
</tr>
<tr class="even">
<td>"Dream"</td>
</tr>
<tr class="odd">
<td>"Dream"</td>
</tr>
<tr class="even">
<td>"Dream"</td>
</tr>
<tr class="odd">
<td>"Dream"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>OKAY! first try now we are cooking! If we wanted to do multiple columns we would do something to the effect of</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(species, island)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 2
   species island   
   &lt;fct&gt;   &lt;fct&gt;    
 1 Adelie  Torgersen
 2 Adelie  Torgersen
 3 Adelie  Torgersen
 4 Adelie  Torgersen
 5 Adelie  Torgersen
 6 Adelie  Torgersen
 7 Adelie  Torgersen
 8 Adelie  Torgersen
 9 Adelie  Torgersen
10 Adelie  Torgersen
# ℹ 334 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>To do multiple columns we could do something to the effect of this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>penguins.select((pl.col(<span class="st">"species"</span>, <span class="st">"island"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (344, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Which feels more natural to me, but to some extent a dictionary would probably be more pythony. One thing I use all the time is using tidyselectors like <code>starts_with</code></p>
<section id="using-selectors" class="level3">
<h3 class="anchored" data-anchor-id="using-selectors">Using Selectors</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"bill"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 2
   bill_length_mm bill_depth_mm
            &lt;dbl&gt;         &lt;dbl&gt;
 1           39.1          18.7
 2           39.5          17.4
 3           40.3          18  
 4           NA            NA  
 5           36.7          19.3
 6           39.3          20.6
 7           38.9          17.8
 8           39.2          19.6
 9           34.1          18.1
10           42            20.2
# ℹ 334 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>penguins.select(cs.starts_with(<span class="st">"bill"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (344, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>39.1</td>
<td>18.7</td>
</tr>
<tr class="even">
<td>39.5</td>
<td>17.4</td>
</tr>
<tr class="odd">
<td>40.3</td>
<td>18.0</td>
</tr>
<tr class="even">
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>36.7</td>
<td>19.3</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>55.8</td>
<td>19.8</td>
</tr>
<tr class="even">
<td>43.5</td>
<td>18.1</td>
</tr>
<tr class="odd">
<td>49.6</td>
<td>18.2</td>
</tr>
<tr class="even">
<td>50.8</td>
<td>19.0</td>
</tr>
<tr class="odd">
<td>50.2</td>
<td>18.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>This is actually so cool that in this case it works exactly like the tidyverse selector functions!</p>
</section>
</section>
<section id="renaming-columns" class="level1">
<h1>Renaming Columns</h1>
<p>I am a simple man I like snake_case but lets say I am more camel case inclined. I may want to rename columns that I am using as to not deal with object not found messages because I am used to typing billLengthMm. In the tidyverse we would do</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="at">BillLengthMm =</span> bill_length_mm,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">BillDepthMm =</span> bill_depth_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island   BillLengthMm BillDepthMm flipper_length_mm body_mass_g sex  
   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;       &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt;
 1 Adelie  Torgers…         39.1        18.7               181        3750 male 
 2 Adelie  Torgers…         39.5        17.4               186        3800 fema…
 3 Adelie  Torgers…         40.3        18                 195        3250 fema…
 4 Adelie  Torgers…         NA          NA                  NA          NA &lt;NA&gt; 
 5 Adelie  Torgers…         36.7        19.3               193        3450 fema…
 6 Adelie  Torgers…         39.3        20.6               190        3650 male 
 7 Adelie  Torgers…         38.9        17.8               181        3625 fema…
 8 Adelie  Torgers…         39.2        19.6               195        4675 male 
 9 Adelie  Torgers…         34.1        18.1               193        3475 &lt;NA&gt; 
10 Adelie  Torgers…         42          20.2               190        4250 &lt;NA&gt; 
# ℹ 334 more rows
# ℹ 1 more variable: year &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> penguins.rename({<span class="st">"bill_length_mm"</span>:<span class="st">"BillLengthMm"</span>,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"bill_depth_mm"</span>:<span class="st">"BillDepthMm"</span>})</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> penguins.rename({<span class="st">"BillLengthMm"</span>: <span class="st">"bill_length_mm"</span>, </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"BillDepthMm"</span>:<span class="st">"bill_depth_mm"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>In effect the thing you need to switch in your head when working in polars is that the order goes <code>old_name</code>:<code>new_name</code> I assigned it to an object because I wanted to test out a module I found online.</p>
</section>
<section id="mutate" class="level1">
<h1>Mutate</h1>
<p>Okay we have worked with subsets now we need to actually create some things. We should also work on chaining things together. Lets first with doing math stuff to the columns. Lets start with how I think it works in polars and if it errors then we can go and fix it</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">sqr_bill_length =</span> bill_length_mm<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(sqr_bill_length) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  sqr_bill_length
            &lt;dbl&gt;
1           1529.
2           1560.
3           1624.
4             NA 
5           1347.
6           1544.</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>penguins.mutate({pl.col(<span class="st">"bill_length_mm"</span>)<span class="op">^</span><span class="dv">2</span>: <span class="st">"sqr_bill_length"</span>}).select(pl.col(<span class="st">"sqr_bill_length"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AttributeError: 'DataFrame' object has no attribute 'mutate'</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Okay where I am coming from is that in my head what we are doing is using the same logic as renaming columns. Lets fix it. So the first problem is that there is no <code>mutate</code> verb. Instead we use <code>with_column</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>penguins.with_columns(sqr_bill_length <span class="op">=</span> pl.col(<span class="st">"bill_length_mm"</span>)<span class="op">**</span><span class="dv">2</span>).select(pl.col(<span class="st">"sqr_bill_length"</span>)).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">sqr_bill_length</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1528.81</td>
</tr>
<tr class="even">
<td>1560.25</td>
</tr>
<tr class="odd">
<td>1624.09</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>1346.89</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Okay this is the general idea. One of the big advantages of mutate is that we chain things together in the same mutate col.&nbsp;So lets say we wanted to square something than return it back to the original value</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">sqr_bill =</span> bill_length_mm<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">og_bill =</span> <span class="fu">sqrt</span>(sqr_bill)) <span class="sc">|&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">select</span>(sqr_bill, og_bill, bill_length_mm) <span class="sc">|&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  sqr_bill og_bill bill_length_mm
     &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;
1    1529.    39.1           39.1
2    1560.    39.5           39.5
3    1624.    40.3           40.3
4      NA     NA             NA  
5    1347.    36.7           36.7</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>penguins.with_columns(sqr_bill <span class="op">=</span> pl.col(<span class="st">"bill_length_mm"</span>)<span class="op">**</span><span class="dv">2</span>).with_columns(og_bill <span class="op">=</span> pl.col(<span class="st">"sqr_bill"</span>).sqrt()).select(pl.col(<span class="st">"sqr_bill"</span>, <span class="st">"og_bill"</span>, <span class="st">"bill_length_mm"</span>)).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">sqr_bill</th>
<th data-quarto-table-cell-role="th">og_bill</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1528.81</td>
<td>39.1</td>
<td>39.1</td>
</tr>
<tr class="even">
<td>1560.25</td>
<td>39.5</td>
<td>39.5</td>
</tr>
<tr class="odd">
<td>1624.09</td>
<td>40.3</td>
<td>40.3</td>
</tr>
<tr class="even">
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>1346.89</td>
<td>36.7</td>
<td>36.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Now the next step is creating conditionals</p>
<section id="ifelse-equivalents" class="level3">
<h3 class="anchored" data-anchor-id="ifelse-equivalents">ifelse equivalents</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">female =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"female"</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(sex, female) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  sex    female
  &lt;fct&gt;  &lt;lgl&gt; 
1 male   FALSE 
2 female TRUE  
3 female TRUE  
4 &lt;NA&gt;   NA    
5 female TRUE  </code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>penguins.with_columns(female <span class="op">=</span> pl.when(pl.col(<span class="st">"sex"</span>) <span class="op">==</span> <span class="st">"female"</span>).then(<span class="va">True</span>).otherwise(<span class="va">False</span>)).select([<span class="st">"sex"</span>, <span class="st">"female"</span>]).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">female</th>
</tr>
<tr class="odd">
<th>str</th>
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"male"</td>
<td>false</td>
</tr>
<tr class="even">
<td>"female"</td>
<td>true</td>
</tr>
<tr class="odd">
<td>"female"</td>
<td>true</td>
</tr>
<tr class="even">
<td>"NA"</td>
<td>false</td>
</tr>
<tr class="odd">
<td>"female"</td>
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Full disclosure this took a much longer time than shown but this is the basic idea. Lets do this to keep myself a bit more honest. Recreate a silly example that I use to teach ifelse using the starwars dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"starwars"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>arrow<span class="sc">::</span><span class="fu">write_parquet</span>(starwars, <span class="st">"starwars.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">dog_years =</span> birth_year <span class="sc">*</span> <span class="dv">7</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">comment =</span> <span class="fu">paste</span>(name, <span class="st">"is"</span>, dog_years, <span class="st">"in dog years"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">select</span>(name, dog_years, comment) <span class="sc">|&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  name           dog_years comment                           
  &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;                             
1 Luke Skywalker      133  Luke Skywalker is 133 in dog years
2 C-3PO               784  C-3PO is 784 in dog years         
3 R2-D2               231  R2-D2 is 231 in dog years         
4 Darth Vader         293. Darth Vader is 293.3 in dog years 
5 Leia Organa         133  Leia Organa is 133 in dog years   </code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="op">=</span> pl.read_parquet(<span class="st">"starwars.parquet"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>starwars.with_columns(dog_years <span class="op">=</span> pl.col(<span class="st">"birth_year"</span>) <span class="op">*</span> <span class="dv">7</span>).with_columns(dog_years_string <span class="op">=</span> pl.col(<span class="st">"dog_years"</span>).cast(<span class="bu">str</span>)).with_columns(comment <span class="op">=</span> pl.col(<span class="st">"name"</span>) <span class="op">+</span> <span class="st">" is "</span> <span class="op">+</span> pl.col(<span class="st">"dog_years_string"</span>) <span class="op">+</span> <span class="st">" in dog years "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (87, 17)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">height</th>
<th data-quarto-table-cell-role="th">mass</th>
<th data-quarto-table-cell-role="th">hair_color</th>
<th data-quarto-table-cell-role="th">skin_color</th>
<th data-quarto-table-cell-role="th">eye_color</th>
<th data-quarto-table-cell-role="th">birth_year</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">homeworld</th>
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">films</th>
<th data-quarto-table-cell-role="th">vehicles</th>
<th data-quarto-table-cell-role="th">starships</th>
<th data-quarto-table-cell-role="th">dog_years</th>
<th data-quarto-table-cell-role="th">dog_years_string</th>
<th data-quarto-table-cell-role="th">comment</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i32</th>
<th>f64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>list[str]</th>
<th>list[str]</th>
<th>list[str]</th>
<th>f64</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Luke Skywalker"</td>
<td>172</td>
<td>77.0</td>
<td>"blond"</td>
<td>"fair"</td>
<td>"blue"</td>
<td>19.0</td>
<td>"male"</td>
<td>"masculine"</td>
<td>"Tatooine"</td>
<td>"Human"</td>
<td>["A New Hope", "The Empire Strikes Back", … "The Force Awakens"]</td>
<td>["Snowspeeder", "Imperial Speeder Bike"]</td>
<td>["X-wing", "Imperial shuttle"]</td>
<td>133.0</td>
<td>"133.0"</td>
<td>"Luke Skywalker is 133.0 in dog…</td>
</tr>
<tr class="even">
<td>"C-3PO"</td>
<td>167</td>
<td>75.0</td>
<td>null</td>
<td>"gold"</td>
<td>"yellow"</td>
<td>112.0</td>
<td>"none"</td>
<td>"masculine"</td>
<td>"Tatooine"</td>
<td>"Droid"</td>
<td>["A New Hope", "The Empire Strikes Back", … "Revenge of the Sith"]</td>
<td>[]</td>
<td>[]</td>
<td>784.0</td>
<td>"784.0"</td>
<td>"C-3PO is 784.0 in dog years "</td>
</tr>
<tr class="odd">
<td>"R2-D2"</td>
<td>96</td>
<td>32.0</td>
<td>null</td>
<td>"white, blue"</td>
<td>"red"</td>
<td>33.0</td>
<td>"none"</td>
<td>"masculine"</td>
<td>"Naboo"</td>
<td>"Droid"</td>
<td>["A New Hope", "The Empire Strikes Back", … "The Force Awakens"]</td>
<td>[]</td>
<td>[]</td>
<td>231.0</td>
<td>"231.0"</td>
<td>"R2-D2 is 231.0 in dog years "</td>
</tr>
<tr class="even">
<td>"Darth Vader"</td>
<td>202</td>
<td>136.0</td>
<td>"none"</td>
<td>"white"</td>
<td>"yellow"</td>
<td>41.9</td>
<td>"male"</td>
<td>"masculine"</td>
<td>"Tatooine"</td>
<td>"Human"</td>
<td>["A New Hope", "The Empire Strikes Back", … "Revenge of the Sith"]</td>
<td>[]</td>
<td>["TIE Advanced x1"]</td>
<td>293.3</td>
<td>"293.3"</td>
<td>"Darth Vader is 293.3 in dog ye…</td>
</tr>
<tr class="odd">
<td>"Leia Organa"</td>
<td>150</td>
<td>49.0</td>
<td>"brown"</td>
<td>"light"</td>
<td>"brown"</td>
<td>19.0</td>
<td>"female"</td>
<td>"feminine"</td>
<td>"Alderaan"</td>
<td>"Human"</td>
<td>["A New Hope", "The Empire Strikes Back", … "The Force Awakens"]</td>
<td>["Imperial Speeder Bike"]</td>
<td>[]</td>
<td>133.0</td>
<td>"133.0"</td>
<td>"Leia Organa is 133.0 in dog ye…</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Finn"</td>
<td>null</td>
<td>null</td>
<td>"black"</td>
<td>"dark"</td>
<td>"dark"</td>
<td>null</td>
<td>"male"</td>
<td>"masculine"</td>
<td>null</td>
<td>"Human"</td>
<td>["The Force Awakens"]</td>
<td>[]</td>
<td>[]</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Rey"</td>
<td>null</td>
<td>null</td>
<td>"brown"</td>
<td>"light"</td>
<td>"hazel"</td>
<td>null</td>
<td>"female"</td>
<td>"feminine"</td>
<td>null</td>
<td>"Human"</td>
<td>["The Force Awakens"]</td>
<td>[]</td>
<td>[]</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Poe Dameron"</td>
<td>null</td>
<td>null</td>
<td>"brown"</td>
<td>"light"</td>
<td>"brown"</td>
<td>null</td>
<td>"male"</td>
<td>"masculine"</td>
<td>null</td>
<td>"Human"</td>
<td>["The Force Awakens"]</td>
<td>[]</td>
<td>["X-wing"]</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>"BB8"</td>
<td>null</td>
<td>null</td>
<td>"none"</td>
<td>"none"</td>
<td>"black"</td>
<td>null</td>
<td>"none"</td>
<td>"masculine"</td>
<td>null</td>
<td>"Droid"</td>
<td>["The Force Awakens"]</td>
<td>[]</td>
<td>[]</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Captain Phasma"</td>
<td>null</td>
<td>null</td>
<td>"none"</td>
<td>"none"</td>
<td>"unknown"</td>
<td>null</td>
<td>"female"</td>
<td>"feminine"</td>
<td>null</td>
<td>"Human"</td>
<td>["The Force Awakens"]</td>
<td>[]</td>
<td>[]</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>It turns out that the column was actually a string</p>
</section>
<section id="converting-columns-to-appropriate-type" class="level3">
<h3 class="anchored" data-anchor-id="converting-columns-to-appropriate-type">Converting columns to appropriate type</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>starwars.glimpse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 87
Columns: 14
$ name             &lt;str&gt; 'Luke Skywalker', 'C-3PO', 'R2-D2', 'Darth Vader', 'Leia Organa', 'Owen Lars', 'Beru Whitesun Lars', 'R5-D4', 'Biggs Darklighter', 'Obi-Wan Kenobi'
$ height           &lt;i32&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182
$ mass             &lt;f64&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 84.0, 77.0
$ hair_color       &lt;str&gt; 'blond', None, None, 'none', 'brown', 'brown, grey', 'brown', None, 'black', 'auburn, white'
$ skin_color       &lt;str&gt; 'fair', 'gold', 'white, blue', 'white', 'light', 'light', 'light', 'white, red', 'light', 'fair'
$ eye_color        &lt;str&gt; 'blue', 'yellow', 'red', 'yellow', 'brown', 'blue', 'blue', 'red', 'brown', 'blue-gray'
$ birth_year       &lt;f64&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, None, 24.0, 57.0
$ sex              &lt;str&gt; 'male', 'none', 'none', 'male', 'female', 'male', 'female', 'none', 'male', 'male'
$ gender           &lt;str&gt; 'masculine', 'masculine', 'masculine', 'masculine', 'feminine', 'masculine', 'feminine', 'masculine', 'masculine', 'masculine'
$ homeworld        &lt;str&gt; 'Tatooine', 'Tatooine', 'Naboo', 'Tatooine', 'Alderaan', 'Tatooine', 'Tatooine', 'Tatooine', 'Tatooine', 'Stewjon'
$ species          &lt;str&gt; 'Human', 'Droid', 'Droid', 'Human', 'Human', 'Human', 'Human', 'Droid', 'Human', 'Human'
$ films      &lt;list[str]&gt; ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'Revenge of the Sith', 'The Force Awakens'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'The Phantom Menace', 'Attack of the Clones', 'Revenge of the Sith'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'The Phantom Menace', 'Attack of the Clones', 'Revenge of the Sith', 'The Force Awakens'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'Revenge of the Sith'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'Revenge of the Sith', 'The Force Awakens'], ['A New Hope', 'Attack of the Clones', 'Revenge of the Sith'], ['A New Hope', 'Attack of the Clones', 'Revenge of the Sith'], ['A New Hope'], ['A New Hope'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'The Phantom Menace', 'Attack of the Clones', 'Revenge of the Sith']
$ vehicles   &lt;list[str]&gt; ['Snowspeeder', 'Imperial Speeder Bike'], [], [], [], ['Imperial Speeder Bike'], [], [], [], [], ['Tribubble bongo']
$ starships  &lt;list[str]&gt; ['X-wing', 'Imperial shuttle'], [], [], ['TIE Advanced x1'], [], [], [], [], ['X-wing'], ['Jedi starfighter', 'Trade Federation cruiser', 'Naboo star skiff', 'Jedi Interceptor', 'Belbullab-22 starfighter']</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>starwars.with_columns(dog_years <span class="op">=</span> pl.col(<span class="st">"birth_year"</span>).<span class="bu">str</span>.to_integer(strict <span class="op">=</span> <span class="va">False</span>)<span class="op">*</span><span class="dv">7</span>).with_columns(dog_years_string <span class="op">=</span> pl.col(<span class="st">"dog_years"</span>).cast(pl.String)).with_columns(comment <span class="op">=</span> pl.col(<span class="st">"name"</span>) <span class="op">+</span> <span class="st">" is "</span> <span class="op">+</span> pl.col(<span class="st">"dog_years_string"</span>)  <span class="op">+</span> <span class="st">" in dog years"</span>).select(pl.col(<span class="st">"name"</span>, <span class="st">"dog_years"</span>, <span class="st">"comment"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>polars.exceptions.SchemaError: invalid series dtype: expected `String`, got `f64`</code></pre>
</div>
</div>
<p>Lets also do this for penguins but make it fun</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>penguins.with_columns(big_peng <span class="op">=</span> pl.when(pl.col(<span class="st">"body_mass_g"</span>) <span class="op">&gt;</span> pl.col(<span class="st">"body_mass_g"</span>).mean()).then(<span class="va">True</span>).otherwise(<span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (344, 9)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">big_peng</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>39.1</td>
<td>18.7</td>
<td>181.0</td>
<td>"3750"</td>
<td>"male"</td>
<td>2007</td>
<td>false</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>39.5</td>
<td>17.4</td>
<td>186.0</td>
<td>"3800"</td>
<td>"female"</td>
<td>2007</td>
<td>false</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>40.3</td>
<td>18.0</td>
<td>195.0</td>
<td>"3250"</td>
<td>"female"</td>
<td>2007</td>
<td>false</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>"NA"</td>
<td>"NA"</td>
<td>2007</td>
<td>false</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>"Torgersen"</td>
<td>36.7</td>
<td>19.3</td>
<td>193.0</td>
<td>"3450"</td>
<td>"female"</td>
<td>2007</td>
<td>false</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>55.8</td>
<td>19.8</td>
<td>207.0</td>
<td>"4000"</td>
<td>"male"</td>
<td>2009</td>
<td>false</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>43.5</td>
<td>18.1</td>
<td>202.0</td>
<td>"3400"</td>
<td>"female"</td>
<td>2009</td>
<td>false</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>49.6</td>
<td>18.2</td>
<td>193.0</td>
<td>"3775"</td>
<td>"male"</td>
<td>2009</td>
<td>false</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>50.8</td>
<td>19.0</td>
<td>210.0</td>
<td>"4100"</td>
<td>"male"</td>
<td>2009</td>
<td>false</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>"Dream"</td>
<td>50.2</td>
<td>18.7</td>
<td>198.0</td>
<td>"3775"</td>
<td>"female"</td>
<td>2009</td>
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="group-by-and-summarize" class="level2">
<h2 class="anchored" data-anchor-id="group-by-and-summarize">Group by and summarize</h2>
<p>Last but not least we need to do the group by and summarise bit. It looks like this is slightly more intuitive</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  species   total
  &lt;fct&gt;     &lt;int&gt;
1 Adelie      152
2 Chinstrap    68
3 Gentoo      124</code></pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>penguins.group_by(pl.col(<span class="st">"species"</span>)).agg(total <span class="op">=</span> pl.count())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">total</th>
</tr>
<tr class="odd">
<th>str</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Chinstrap"</td>
<td>68</td>
</tr>
<tr class="even">
<td>"Gentoo"</td>
<td>124</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>152</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Lets do some mathy stuff</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>penguins.group_by(pl.col(<span class="st">"species"</span>)).agg(count <span class="op">=</span> pl.<span class="bu">len</span>(),</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                                         mean_flipp <span class="op">=</span> pl.mean(<span class="st">"flipper_length_mm"</span>),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                                         median_flipp <span class="op">=</span> pl.median(<span class="st">"flipper_length_mm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean_flipp</th>
<th data-quarto-table-cell-role="th">median_flipp</th>
</tr>
<tr class="odd">
<th>str</th>
<th>u32</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Chinstrap"</td>
<td>68</td>
<td>195.823529</td>
<td>196.0</td>
</tr>
<tr class="even">
<td>"Gentoo"</td>
<td>124</td>
<td>217.186992</td>
<td>216.0</td>
</tr>
<tr class="odd">
<td>"Adelie"</td>
<td>152</td>
<td>189.953642</td>
<td>190.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="across" class="level3">
<h3 class="anchored" data-anchor-id="across">across</h3>
<p>A thing that is useful in summarize is that we can use our selectors to summarise across multiple columns like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"bill"</span>), <span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">median =</span> \(x) <span class="fu">median</span>(x, na.rm,  <span class="cn">TRUE</span>)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  species   bill_length_mm_mean bill_depth_mm_mean
  &lt;fct&gt;                   &lt;dbl&gt;              &lt;dbl&gt;
1 Adelie                   38.8               18.3
2 Chinstrap                48.8               18.4
3 Gentoo                   47.5               15.0</code></pre>
</div>
</div>
<p>In polars I imagine it would probably be something like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>penguins.group_by(pl.col(<span class="st">"species"</span>)).agg(cs.starts_with(<span class="st">"bill"</span>).mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
</tr>
<tr class="odd">
<th>str</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Gentoo"</td>
<td>47.504878</td>
<td>14.982114</td>
</tr>
<tr class="even">
<td>"Adelie"</td>
<td>38.791391</td>
<td>18.346358</td>
</tr>
<tr class="odd">
<td>"Chinstrap"</td>
<td>48.833824</td>
<td>18.420588</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The think I am running into now is that I would like to add a <code>_</code> without doing any extra work. It looks like according to the docs it should be this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>penguins.group_by(pl.col(<span class="st">"species"</span>)).agg(cs.starts_with(<span class="st">"bill"</span>).mean().name.suffix(<span class="st">"_mean"</span>),</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                                         cs.starts_with(<span class="st">"bill"</span>).median().name.suffix(<span class="st">"_median"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">bill_length_mm_mean</th>
<th data-quarto-table-cell-role="th">bill_depth_mm_mean</th>
<th data-quarto-table-cell-role="th">bill_length_mm_median</th>
<th data-quarto-table-cell-role="th">bill_depth_mm_median</th>
</tr>
<tr class="odd">
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Adelie"</td>
<td>38.791391</td>
<td>18.346358</td>
<td>38.8</td>
<td>18.4</td>
</tr>
<tr class="even">
<td>"Chinstrap"</td>
<td>48.833824</td>
<td>18.420588</td>
<td>49.55</td>
<td>18.45</td>
</tr>
<tr class="odd">
<td>"Gentoo"</td>
<td>47.504878</td>
<td>14.982114</td>
<td>47.3</td>
<td>15.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="joins-in-polars" class="level1">
<h1>Joins in Polars</h1>
<p>It would be nice if we had all the data we wanted in one dataset but that is not life we often need to join data. Critically we also would not want to have all our data in one place if we care about users safety. So we may want to keep portions of the dataset in separate places. So lets define a simple dataset to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>national_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>state, <span class="sc">~</span>year, <span class="sc">~</span>unemployment, <span class="sc">~</span>inflation, <span class="sc">~</span>population,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GA"</span>,   <span class="dv">2018</span>,  <span class="dv">5</span>,             <span class="dv">2</span>,          <span class="dv">100</span>,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GA"</span>,   <span class="dv">2019</span>,  <span class="fl">5.3</span>,           <span class="fl">1.8</span>,        <span class="dv">200</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GA"</span>,   <span class="dv">2020</span>,  <span class="fl">5.2</span>,           <span class="fl">2.5</span>,        <span class="dv">300</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NC"</span>,   <span class="dv">2018</span>,  <span class="fl">6.1</span>,           <span class="fl">1.8</span>,        <span class="dv">350</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NC"</span>,   <span class="dv">2019</span>,  <span class="fl">5.9</span>,           <span class="fl">1.6</span>,        <span class="dv">375</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NC"</span>,   <span class="dv">2020</span>,  <span class="fl">5.3</span>,           <span class="fl">1.8</span>,        <span class="dv">400</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CO"</span>,   <span class="dv">2018</span>,  <span class="fl">4.7</span>,           <span class="fl">2.7</span>,        <span class="dv">200</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CO"</span>,   <span class="dv">2019</span>,  <span class="fl">4.4</span>,           <span class="fl">2.6</span>,        <span class="dv">300</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CO"</span>,   <span class="dv">2020</span>,  <span class="fl">5.1</span>,           <span class="fl">2.5</span>,        <span class="dv">400</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>national_libraries <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>state, <span class="sc">~</span>year, <span class="sc">~</span>libraries, <span class="sc">~</span>schools,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CO"</span>,   <span class="dv">2018</span>,  <span class="dv">230</span>,        <span class="dv">470</span>,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CO"</span>,   <span class="dv">2019</span>,  <span class="dv">240</span>,        <span class="dv">440</span>,</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CO"</span>,   <span class="dv">2020</span>,  <span class="dv">270</span>,        <span class="dv">510</span>,</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NC"</span>,   <span class="dv">2018</span>,  <span class="dv">200</span>,        <span class="dv">610</span>,</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NC"</span>,   <span class="dv">2019</span>,  <span class="dv">210</span>,        <span class="dv">590</span>,</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NC"</span>,   <span class="dv">2020</span>,  <span class="dv">220</span>,        <span class="dv">530</span>,</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>national_dict <span class="op">=</span> {<span class="st">"state"</span>: [<span class="st">"Ga"</span>, <span class="st">"Ga"</span>, <span class="st">"Ga"</span>,  <span class="st">"NC"</span>, <span class="st">"NC"</span>, <span class="st">"NC"</span>, <span class="st">"CO"</span>, <span class="st">"CO"</span>, <span class="st">"CO"</span>], <span class="st">"unemployment"</span>:[<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>], <span class="st">"year"</span>: [<span class="dv">2019</span>,<span class="dv">2018</span>,<span class="dv">2017</span>,<span class="dv">2019</span>,<span class="dv">2018</span>,<span class="dv">2017</span>,<span class="dv">2019</span>,<span class="dv">2018</span>,<span class="dv">2017</span>]}</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>national_data <span class="op">=</span> pl.DataFrame(national_dict)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>library_dict <span class="op">=</span> {<span class="st">"state"</span>:[<span class="st">"CO"</span>, <span class="st">"CO"</span>, <span class="st">"CO"</span>], <span class="st">"libraries"</span>: [<span class="dv">23234</span>,<span class="dv">2343234</span>,<span class="dv">32342342</span>], <span class="st">"year"</span>:[<span class="dv">2019</span>,<span class="dv">2018</span>,<span class="dv">2017</span>]}</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>library_data <span class="op">=</span> pl.DataFrame(library_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We may want to merge in the library dataset. In tidyland we would do something like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>national_data <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(national_libraries, <span class="fu">join_by</span>(state, year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 7
  state  year unemployment inflation population libraries schools
  &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 GA     2018          5         2          100        NA      NA
2 GA     2019          5.3       1.8        200        NA      NA
3 GA     2020          5.2       2.5        300        NA      NA
4 NC     2018          6.1       1.8        350       200     610
5 NC     2019          5.9       1.6        375       210     590
6 NC     2020          5.3       1.8        400       220     530
7 CO     2018          4.7       2.7        200       230     470
8 CO     2019          4.4       2.6        300       240     440
9 CO     2020          5.1       2.5        400       270     510</code></pre>
</div>
</div>
<p>In polars land we would join the data like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>joined_data <span class="op">=</span> national_data.join(library_data, on <span class="op">=</span> [<span class="st">"state"</span>,<span class="st">"year"</span>], how <span class="op">=</span> <span class="st">"left"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>joined_data </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">unemployment</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">libraries</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Ga"</td>
<td>6</td>
<td>2019</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Ga"</td>
<td>6</td>
<td>2018</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Ga"</td>
<td>8</td>
<td>2017</td>
<td>null</td>
</tr>
<tr class="even">
<td>"NC"</td>
<td>6</td>
<td>2019</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"NC"</td>
<td>4</td>
<td>2018</td>
<td>null</td>
</tr>
<tr class="even">
<td>"NC"</td>
<td>3</td>
<td>2017</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"CO"</td>
<td>7</td>
<td>2019</td>
<td>23234</td>
</tr>
<tr class="even">
<td>"CO"</td>
<td>8</td>
<td>2018</td>
<td>2343234</td>
</tr>
<tr class="odd">
<td>"CO"</td>
<td>9</td>
<td>2017</td>
<td>32342342</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This is honestly pretty comfortable. One thing that is really nice about dplyr is that you can pretty easily join columns that are not named the same thing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>national_libraries <span class="ot">=</span> national_libraries <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="at">state_name =</span> state)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>national_data <span class="sc">|&gt;</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(national_libraries, <span class="fu">join_by</span>(state <span class="sc">==</span> state_name, year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 7
  state  year unemployment inflation population libraries schools
  &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 GA     2018          5         2          100        NA      NA
2 GA     2019          5.3       1.8        200        NA      NA
3 GA     2020          5.2       2.5        300        NA      NA
4 NC     2018          6.1       1.8        350       200     610
5 NC     2019          5.9       1.6        375       210     590
6 NC     2020          5.3       1.8        400       220     530
7 CO     2018          4.7       2.7        200       230     470
8 CO     2019          4.4       2.6        300       240     440
9 CO     2020          5.1       2.5        400       270     510</code></pre>
</div>
</div>
<p>In polars the process is less clear immediately. Instead of a nice <code>join_by</code> argument you have specify the keys separately. But still pretty intuitive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>library_dat <span class="op">=</span> library_data.rename({<span class="st">"state"</span>: <span class="st">"state_name"</span>})</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>national_data.join(library_dat, left_on <span class="op">=</span> [<span class="st">"state"</span>, <span class="st">"year"</span>],</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>               right_on <span class="op">=</span> [<span class="st">"state_name"</span>, <span class="st">"year"</span>], how <span class="op">=</span> <span class="st">"left"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">unemployment</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">libraries</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Ga"</td>
<td>6</td>
<td>2019</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Ga"</td>
<td>6</td>
<td>2018</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Ga"</td>
<td>8</td>
<td>2017</td>
<td>null</td>
</tr>
<tr class="even">
<td>"NC"</td>
<td>6</td>
<td>2019</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"NC"</td>
<td>4</td>
<td>2018</td>
<td>null</td>
</tr>
<tr class="even">
<td>"NC"</td>
<td>3</td>
<td>2017</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"CO"</td>
<td>7</td>
<td>2019</td>
<td>23234</td>
</tr>
<tr class="even">
<td>"CO"</td>
<td>8</td>
<td>2018</td>
<td>2343234</td>
</tr>
<tr class="odd">
<td>"CO"</td>
<td>9</td>
<td>2017</td>
<td>32342342</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="binding-rows" class="level1">
<h1>Binding Rows</h1>
<p>Sometimes we just want to add rows to our data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">vals =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>b  <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">vals =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>a <span class="sc">|&gt;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id vals
1  1    1
2  2    2
3  3    3
4  4    4</code></pre>
</div>
</div>
<p>or we want to add columns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">chars =</span> <span class="fu">c</span>(<span class="st">"hello"</span>, <span class="st">"lorem"</span>),</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">var_23 =</span> <span class="fu">c</span>(<span class="st">"world"</span>, <span class="st">"ipsum"</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>a <span class="sc">|&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id vals chars var_23
1  1    1 hello  world
2  2    2 lorem  ipsum</code></pre>
</div>
</div>
<p>How would we do this in polars?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> pl.DataFrame(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>       {<span class="st">"a"</span>: [<span class="dv">1</span>,<span class="dv">2</span>],</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="dv">3</span>,<span class="dv">4</span>]}</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> pl.DataFrame({<span class="st">"a"</span> : [<span class="dv">3</span>,<span class="dv">4</span>], <span class="st">"b"</span>: [<span class="dv">5</span>,<span class="dv">6</span>]})</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>pl.concat([a, b], how <span class="op">=</span> <span class="st">"vertical"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
</tr>
<tr class="even">
<td>4</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Again fairly intuitive if we wanted to bind the columns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> pl.DataFrame({<span class="st">"chars"</span>: [<span class="st">"hello"</span>, <span class="st">"lorem"</span>], <span class="st">"chars2"</span>:[<span class="st">"world"</span>,<span class="st">"ipsum"</span>]})</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>pl.concat([a,c], how <span class="op">=</span> <span class="st">"horizontal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">chars</th>
<th data-quarto-table-cell-role="th">chars2</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3</td>
<td>"hello"</td>
<td>"world"</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>"lorem"</td>
<td>"ipsum"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="tidyr" class="level1">
<h1>Tidyr</h1>
<section id="pivots-of-all-shapes" class="level2">
<h2 class="anchored" data-anchor-id="pivots-of-all-shapes">Pivots of all shapes</h2>
<p>Sometimes we need to pivot our data. Lets use the built in example from tidyr. Basically we have a whole bunch of columns that denote counts of income brackets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>relig <span class="ot">=</span> relig_income</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(relig,<span class="st">"relig_income.csv"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(relig_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  religion  `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
  &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 Agnostic       27        34        60        81        76       137        122
2 Atheist        12        27        37        52        35        70         73
3 Buddhist       27        21        30        34        33        58         62
4 Catholic      418       617       732       670       638      1116        949
5 Don’t kn…      15        14        15        11        10        35         21
6 Evangeli…     575       869      1064       982       881      1486        949
# ℹ 3 more variables: `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;,
#   `Don't know/refused` &lt;dbl&gt;</code></pre>
</div>
</div>
<p>In tidyr we would just do this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>relig <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(<span class="sc">-</span>religion,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_to =</span> <span class="st">"income_bracket"</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_to =</span> <span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 3
   religion income_bracket     count
   &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;
 1 Agnostic &lt;$10k                 27
 2 Agnostic $10-20k               34
 3 Agnostic $20-30k               60
 4 Agnostic $30-40k               81
 5 Agnostic $40-50k               76
 6 Agnostic $50-75k              137
 7 Agnostic $75-100k             122
 8 Agnostic $100-150k            109
 9 Agnostic &gt;150k                 84
10 Agnostic Don't know/refused    96
# ℹ 170 more rows</code></pre>
</div>
</div>
<p>which is nice because we can just identify a column and then pivot. One thing that I will have to just memorize is that when we are moving things to long in polars than we melt the dataframe. Kind of like a popsicle or something. The mnemonic device will come to me eventually</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>relig <span class="op">=</span> pl.read_csv(<span class="st">"relig_income.csv"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>relig.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 11)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">religion</th>
<th data-quarto-table-cell-role="th">&lt;$10k</th>
<th data-quarto-table-cell-role="th">$10-20k</th>
<th data-quarto-table-cell-role="th">$20-30k</th>
<th data-quarto-table-cell-role="th">$30-40k</th>
<th data-quarto-table-cell-role="th">$40-50k</th>
<th data-quarto-table-cell-role="th">$50-75k</th>
<th data-quarto-table-cell-role="th">$75-100k</th>
<th data-quarto-table-cell-role="th">$100-150k</th>
<th data-quarto-table-cell-role="th">&gt;150k</th>
<th data-quarto-table-cell-role="th">Don't know/refused</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Agnostic"</td>
<td>27</td>
<td>34</td>
<td>60</td>
<td>81</td>
<td>76</td>
<td>137</td>
<td>122</td>
<td>109</td>
<td>84</td>
<td>96</td>
</tr>
<tr class="even">
<td>"Atheist"</td>
<td>12</td>
<td>27</td>
<td>37</td>
<td>52</td>
<td>35</td>
<td>70</td>
<td>73</td>
<td>59</td>
<td>74</td>
<td>76</td>
</tr>
<tr class="odd">
<td>"Buddhist"</td>
<td>27</td>
<td>21</td>
<td>30</td>
<td>34</td>
<td>33</td>
<td>58</td>
<td>62</td>
<td>39</td>
<td>53</td>
<td>54</td>
</tr>
<tr class="even">
<td>"Catholic"</td>
<td>418</td>
<td>617</td>
<td>732</td>
<td>670</td>
<td>638</td>
<td>1116</td>
<td>949</td>
<td>792</td>
<td>633</td>
<td>1489</td>
</tr>
<tr class="odd">
<td>"Don’t know/refused"</td>
<td>15</td>
<td>14</td>
<td>15</td>
<td>11</td>
<td>10</td>
<td>35</td>
<td>21</td>
<td>17</td>
<td>18</td>
<td>116</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>To melt all we do is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>relig.melt(id_vars <span class="op">=</span> <span class="st">"religion"</span>, variable_name <span class="op">=</span> <span class="st">"income_bracket"</span>, value_name <span class="op">=</span> <span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (180, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">religion</th>
<th data-quarto-table-cell-role="th">income_bracket</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Agnostic"</td>
<td>"&lt;$10k"</td>
<td>27</td>
</tr>
<tr class="even">
<td>"Atheist"</td>
<td>"&lt;$10k"</td>
<td>12</td>
</tr>
<tr class="odd">
<td>"Buddhist"</td>
<td>"&lt;$10k"</td>
<td>27</td>
</tr>
<tr class="even">
<td>"Catholic"</td>
<td>"&lt;$10k"</td>
<td>418</td>
</tr>
<tr class="odd">
<td>"Don’t know/refused"</td>
<td>"&lt;$10k"</td>
<td>15</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Orthodox"</td>
<td>"Don't know/refused"</td>
<td>73</td>
</tr>
<tr class="even">
<td>"Other Christian"</td>
<td>"Don't know/refused"</td>
<td>18</td>
</tr>
<tr class="odd">
<td>"Other Faiths"</td>
<td>"Don't know/refused"</td>
<td>71</td>
</tr>
<tr class="even">
<td>"Other World Religions"</td>
<td>"Don't know/refused"</td>
<td>8</td>
</tr>
<tr class="odd">
<td>"Unaffiliated"</td>
<td>"Don't know/refused"</td>
<td>597</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>same would go for the pivoting wider</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>penguins.pivot(index <span class="op">=</span> <span class="st">"island"</span>,columns <span class="op">=</span> <span class="st">"species"</span>, values <span class="op">=</span> <span class="st">"body_mass_g"</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>              aggregate_function<span class="op">=</span><span class="st">"sum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">Adelie</th>
<th data-quarto-table-cell-role="th">Gentoo</th>
<th data-quarto-table-cell-role="th">Chinstrap</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Torgersen"</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Biscoe"</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Dream"</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>this isn’t quite the same because we are aggregating it. This is likely just a skill issue on the user end. But still we have wide data now!</p>
<section id="using-selectors-in-pivot-longer" class="level3">
<h3 class="anchored" data-anchor-id="using-selectors-in-pivot-longer">Using selectors in pivot longer</h3>
<p>A slightly more complex example is using the billboards datas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>billboards <span class="ot">=</span> tidyr<span class="sc">::</span>billboard</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(billboards, <span class="st">"billboard.csv"</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(billboards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 79
  artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
  &lt;chr&gt;       &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 2 Pac       Baby… 2000-02-26      87    82    72    77    87    94    99    NA
2 2Ge+her     The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
3 3 Doors Do… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
4 3 Doors Do… Loser 2000-10-21      76    76    72    69    67    65    55    59
5 504 Boyz    Wobb… 2000-04-15      57    34    25    17    17    31    36    49
6 98^0        Give… 2000-08-19      51    39    34    26    26    19     2     2
# ℹ 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
#   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
#   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
#   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
#   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
#   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;,
#   wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a> billboards <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"wk"</span>),</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_to =</span> <span class="st">"week"</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_to =</span> <span class="st">"count_of_weeks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24,092 × 5
   artist track                   date.entered week  count_of_weeks
   &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt;          &lt;dbl&gt;
 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1               87
 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2               82
 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3               72
 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4               77
 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5               87
 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6               94
 7 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk7               99
 8 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk8               NA
 9 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk9               NA
10 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk10              NA
# ℹ 24,082 more rows</code></pre>
</div>
</div>
<p>We can do something similar with polars by using our selectors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>billboards <span class="op">=</span> pl.read_csv(<span class="st">"billboard.csv"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>billboards.melt(id_vars <span class="op">=</span> <span class="st">"artist"</span>,value_vars  <span class="op">=</span> cs.starts_with(<span class="st">"wk"</span>),</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                variable_name <span class="op">=</span> <span class="st">"week"</span>, value_name <span class="op">=</span> <span class="st">"count"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (24_092, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">artist</th>
<th data-quarto-table-cell-role="th">week</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"2 Pac"</td>
<td>"wk1"</td>
<td>"87"</td>
</tr>
<tr class="even">
<td>"2Ge+her"</td>
<td>"wk1"</td>
<td>"91"</td>
</tr>
<tr class="odd">
<td>"3 Doors Down"</td>
<td>"wk1"</td>
<td>"81"</td>
</tr>
<tr class="even">
<td>"3 Doors Down"</td>
<td>"wk1"</td>
<td>"76"</td>
</tr>
<tr class="odd">
<td>"504 Boyz"</td>
<td>"wk1"</td>
<td>"57"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Yankee Grey"</td>
<td>"wk76"</td>
<td>"NA"</td>
</tr>
<tr class="even">
<td>"Yearwood, Trisha"</td>
<td>"wk76"</td>
<td>"NA"</td>
</tr>
<tr class="odd">
<td>"Ying Yang Twins"</td>
<td>"wk76"</td>
<td>"NA"</td>
</tr>
<tr class="even">
<td>"Zombie Nation"</td>
<td>"wk76"</td>
<td>"NA"</td>
</tr>
<tr class="odd">
<td>"matchbox twenty"</td>
<td>"wk76"</td>
<td>"NA"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Broadly it works the same but if you don’t specify the id vars you will end up with just the week and count column</p>
</section>
</section>
<section id="unnest" class="level2">
<h2 class="anchored" data-anchor-id="unnest">Unnest</h2>
<p>Sometimes we have these unfriendly list columns that we would like to make not lists. Lets go ahead and use the starwars list columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>starwars_lists <span class="ot">=</span> starwars <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(name, <span class="fu">where</span>(is.list)) <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unnest_longer</span>(starships , <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unnest_longer</span>(films, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unnest_longer</span>(vehicles, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars_lists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name           films                   vehicles              starships
  &lt;chr&gt;          &lt;chr&gt;                   &lt;chr&gt;                 &lt;chr&gt;    
1 Luke Skywalker A New Hope              Snowspeeder           X-wing   
2 Luke Skywalker A New Hope              Imperial Speeder Bike X-wing   
3 Luke Skywalker The Empire Strikes Back Snowspeeder           X-wing   
4 Luke Skywalker The Empire Strikes Back Imperial Speeder Bike X-wing   
5 Luke Skywalker Return of the Jedi      Snowspeeder           X-wing   
6 Luke Skywalker Return of the Jedi      Imperial Speeder Bike X-wing   </code></pre>
</div>
</div>
<p>In polars we have a similarish function named <code>explode</code>. Unfortunately we don’t have a a selector for all attribute types so we are going to do this by hand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>starwars_list <span class="op">=</span> starwars.select([<span class="st">"name"</span>, <span class="st">"films"</span>, <span class="st">"vehicles"</span>, <span class="st">"starships"</span>])</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>starwars_list.glimpse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 87
Columns: 4
$ name            &lt;str&gt; 'Luke Skywalker', 'C-3PO', 'R2-D2', 'Darth Vader', 'Leia Organa', 'Owen Lars', 'Beru Whitesun Lars', 'R5-D4', 'Biggs Darklighter', 'Obi-Wan Kenobi'
$ films     &lt;list[str]&gt; ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'Revenge of the Sith', 'The Force Awakens'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'The Phantom Menace', 'Attack of the Clones', 'Revenge of the Sith'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'The Phantom Menace', 'Attack of the Clones', 'Revenge of the Sith', 'The Force Awakens'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'Revenge of the Sith'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'Revenge of the Sith', 'The Force Awakens'], ['A New Hope', 'Attack of the Clones', 'Revenge of the Sith'], ['A New Hope', 'Attack of the Clones', 'Revenge of the Sith'], ['A New Hope'], ['A New Hope'], ['A New Hope', 'The Empire Strikes Back', 'Return of the Jedi', 'The Phantom Menace', 'Attack of the Clones', 'Revenge of the Sith']
$ vehicles  &lt;list[str]&gt; ['Snowspeeder', 'Imperial Speeder Bike'], [], [], [], ['Imperial Speeder Bike'], [], [], [], [], ['Tribubble bongo']
$ starships &lt;list[str]&gt; ['X-wing', 'Imperial shuttle'], [], [], ['TIE Advanced x1'], [], [], [], [], ['X-wing'], ['Jedi starfighter', 'Trade Federation cruiser', 'Naboo star skiff', 'Jedi Interceptor', 'Belbullab-22 starfighter']</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>starwars_explode <span class="op">=</span>  starwars_list.explode(<span class="st">"films"</span>).explode(<span class="st">"vehicles"</span>).explode(<span class="st">"starships"</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>starwars_explode.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">films</th>
<th data-quarto-table-cell-role="th">vehicles</th>
<th data-quarto-table-cell-role="th">starships</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Luke Skywalker"</td>
<td>"A New Hope"</td>
<td>"Snowspeeder"</td>
<td>"X-wing"</td>
</tr>
<tr class="even">
<td>"Luke Skywalker"</td>
<td>"A New Hope"</td>
<td>"Snowspeeder"</td>
<td>"Imperial shuttle"</td>
</tr>
<tr class="odd">
<td>"Luke Skywalker"</td>
<td>"A New Hope"</td>
<td>"Imperial Speeder Bike"</td>
<td>"X-wing"</td>
</tr>
<tr class="even">
<td>"Luke Skywalker"</td>
<td>"A New Hope"</td>
<td>"Imperial Speeder Bike"</td>
<td>"Imperial shuttle"</td>
</tr>
<tr class="odd">
<td>"Luke Skywalker"</td>
<td>"The Empire Strikes Back"</td>
<td>"Snowspeeder"</td>
<td>"X-wing"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="plotting-data" class="level1">
<h1>Plotting data</h1>
<p>Confession time. I hate matplots I never think they look very nice. However I as somebody who enjoys data visualization should learn how to do it in python too. From what I can tell there are a few different attempts at porting over ggplot. But It seems like working in something somewhat standard versus going polars and ibis all the way probably makes sense.</p>
<p>One thing that should be mentioned is that missing values in python are not the same. Since quarto was getting mad at me for some reason about not having installed the palmer penguins package I decided to stop fighting with it. One thing that is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> pd.read_csv(<span class="st">"penguins.csv"</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style <span class="op">=</span> <span class="st">"whitegrid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So I think seaborne might be the way to go. Since I don’t think histograms will go out of style lets just go and make a histogram</p>
<section id="histograms" class="level2">
<h2 class="anchored" data-anchor-id="histograms">Histograms</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"body_mass_g"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>easy enough</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue  <span class="op">=</span> <span class="st">"species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-63-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What if we wanted densities instead of frequencies? In ggplot it would be</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">fill =</span> species)) <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span>  <span class="fu">after_stat</span>(density)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-64-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In sns it would be.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue <span class="op">=</span> <span class="st">"species"</span>, stat <span class="op">=</span> <span class="st">"density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I really like the legend on the inside! In new <code>ggplot 3.whatever</code> it is different now that there is an explicit <code>legend.position="inside"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">fill =</span> species)) <span class="sc">+</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>,.<span class="dv">95</span>),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-66-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Cool I like that and will fiddle with that my ggplot theme!</p>
<p>Okay lets now go and do some bivariate plots. Obviously the workhorse of bivariate plotting is the scatterplot .</p>
</section>
<section id="scatter-plots" class="level2">
<h2 class="anchored" data-anchor-id="scatter-plots">Scatter Plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"flipper_length_mm"</span>, y <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue <span class="op">=</span> <span class="st">"species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>the next thing that we would want is to size points by the size of the penguin</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"flipper_length_mm"</span>, y <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue <span class="op">=</span> <span class="st">"species"</span>, size <span class="op">=</span> <span class="st">"body_mass_g"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-68-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That is not really great since the legend is inside and covering stuff. In ggplot we would simply just move the legend position. In this case we have to save it as an object</p>
</section>
<section id="adjusting-legend" class="level2">
<h2 class="anchored" data-anchor-id="adjusting-legend">Adjusting legend</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>exmp <span class="op">=</span> sns.scatterplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"flipper_length_mm"</span>, y <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue <span class="op">=</span> <span class="st">"species"</span>, size <span class="op">=</span> <span class="st">"body_mass_g"</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>sns.move_legend(exmp, <span class="st">"upper left"</span>, bbox_to_anchor <span class="op">=</span> (<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-69-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>sns.lmplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"flipper_length_mm"</span>, y <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue <span class="op">=</span> <span class="st">"species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-70-7.png" class="img-fluid figure-img" width="297"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-70-8.png" class="img-fluid figure-img" width="596"></p>
</figure>
</div>
</div>
</div>
<p>Then the other one that I use all the time is using a line of best fit . Okay obviously the most annoying part is that we don’t have great labels</p>
</section>
<section id="adding-informative-labels" class="level2">
<h2 class="anchored" data-anchor-id="adding-informative-labels">Adding Informative Labels</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>labs_examp <span class="op">=</span> sns.lmplot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"flipper_length_mm"</span>, y <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue <span class="op">=</span> <span class="st">"species"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>labs_examp.set_axis_labels(x_var<span class="op">=</span> <span class="st">"Flipper Length(mm)"</span>, y_var <span class="op">=</span> <span class="st">"Body Mass(g)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-71-11.png" class="img-fluid figure-img" width="296"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-71-12.png" class="img-fluid figure-img" width="596"></p>
</figure>
</div>
</div>
</div>
<p>One of the things we may want to do is to create small multiples.</p>
</section>
<section id="facet-wrap" class="level2">
<h2 class="anchored" data-anchor-id="facet-wrap">Facet Wrap</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>sns.displot(data <span class="op">=</span> penguins, x <span class="op">=</span> <span class="st">"body_mass_g"</span>, hue <span class="op">=</span> <span class="st">"species"</span>, row<span class="op">=</span> <span class="st">"species"</span>, facet_kws <span class="op">=</span> <span class="bu">dict</span>(margin_titles<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-72-15.png" class="img-fluid figure-img" width="307"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-72-16.png" class="img-fluid figure-img" width="596"></p>
</figure>
</div>
</div>
</div>
<p>I am honestly not wild about the plot but that is life</p>
</section>
</section>
<section id="modeling" class="level1">
<h1>Modeling</h1>
<p>The last step in the journey is really just learning the basics of modeling. The annoying part is that there is no native support for our favorite stats stuff. So no trusty dust glm or OLS when you open up python. From the excellent <a href="https://marginaleffects.com/vignettes/get_started.html">marginaleffects package</a> it looks like there is a nice interface called <code>statsmodels</code> and they have a formula api which works like modeling in <code>R</code> just without lazy evaluation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets fit a few simple models to try and get the hang of statsmodels and see what happens. I will also load <code>broom</code> since I find that it makes working with all the various list components that R spits less annoying to work with.</p>
<p>Lets fit a univariate model first and then we can start playing with the api a little more</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>naive <span class="ot">=</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm, <span class="at">data =</span> penguins)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(naive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term              estimate std.error statistic   p.value
  &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)        -5781.     306.       -18.9 5.59e- 55
2 flipper_length_mm     49.7      1.52      32.7 4.37e-107</code></pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>naive <span class="op">=</span> smf.ols(<span class="st">"body_mass_g ~ flipper_length_mm"</span>, data <span class="op">=</span> penguins).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The biggest difference between the two approaches is that specifying the model and fitting the model are two different steps. If we wanted to see a similar print out we would have to do something like</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>naive.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>body_mass_g</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.759</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.758</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>1071.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Wed, 03 Jul 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>4.37e-107</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>13:43:31</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-2528.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>342</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>5061.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>340</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>5069.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>1</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>-5780.8314</td>
<td>305.815</td>
<td>-18.903</td>
<td>0.000</td>
<td>-6382.358</td>
<td>-5179.305</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">flipper_length_mm</td>
<td>49.6856</td>
<td>1.518</td>
<td>32.722</td>
<td>0.000</td>
<td>46.699</td>
<td>52.672</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>5.634</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>2.190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.060</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>5.585</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>0.313</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.0613</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>3.019</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>2.89e+03</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 2.89e+03. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<p>Cool. A multivariate model would broadly be the same. One thing that we can do in R is we can transform the predictors in the formula like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>squared <span class="ot">=</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> <span class="fu">I</span>(flipper_length_mm<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> bill_depth_mm,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> penguins)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term                    estimate std.error statistic     p.value
  &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 (Intercept)            16824.     4532.         3.71 0.000240   
2 flipper_length_mm       -181.       44.9       -4.04 0.0000669  
3 I(flipper_length_mm^2)     0.573     0.110      5.19 0.000000363
4 bill_depth_mm             29.3      12.9        2.28 0.0232     </code></pre>
</div>
</div>
<p>We can do something like it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>squared <span class="op">=</span> smf.ols(<span class="st">"body_mass_g ~ flipper_length_mm**2 + flipper_length_mm  + bill_depth_mm"</span>, data <span class="op">=</span> penguins).fit()</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>squared.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>body_mass_g</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.761</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>539.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Wed, 03 Jul 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>4.23e-106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>13:43:31</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-2527.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>342</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>5060.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>339</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>5071.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>2</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>-6541.9075</td>
<td>540.751</td>
<td>-12.098</td>
<td>0.000</td>
<td>-7605.557</td>
<td>-5478.258</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">flipper_length_mm</td>
<td>51.5414</td>
<td>1.865</td>
<td>27.635</td>
<td>0.000</td>
<td>47.873</td>
<td>55.210</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">bill_depth_mm</td>
<td>22.6341</td>
<td>13.280</td>
<td>1.704</td>
<td>0.089</td>
<td>-3.488</td>
<td>48.756</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>5.490</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>2.069</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.064</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>5.361</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>0.305</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.0685</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>3.067</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>5.14e+03</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 5.14e+03. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<p>However the results differ pretty wildly! Luckily there is an I operator in the underlying thing that makes this work. The problem is that it only works on pandas dataframes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>penguins_pd <span class="op">=</span> pd.read_csv(<span class="st">'penguins.csv'</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>squared <span class="op">=</span> smf.ols(<span class="st">'body_mass_g ~ I(flipper_length_mm**2) + flipper_length_mm + bill_depth_mm'</span>, data <span class="op">=</span> penguins_pd).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the results are lining up. As a political scientist by training we love ourselves an interaction term.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>interacted <span class="ot">=</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_depth_mm <span class="sc">*</span> species <span class="sc">+</span> flipper_length_mm,</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> penguins) </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(interacted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  term                           estimate std.error statistic  p.value
  &lt;chr&gt;                             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)                     -4213.     648.      -6.50  2.84e-10
2 bill_depth_mm                     176.      22.6      7.81  7.22e-14
3 speciesChinstrap                 1008.     771.       1.31  1.92e- 1
4 speciesGentoo                     129.     608.       0.213 8.32e- 1
5 flipper_length_mm                  24.6      3.17     7.76  1.04e-13
6 bill_depth_mm:speciesChinstrap    -61.5     42.0     -1.47  1.44e- 1
7 bill_depth_mm:speciesGentoo        78.0     38.5      2.02  4.37e- 2</code></pre>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>interacted <span class="op">=</span> smf.ols(<span class="st">"body_mass_g ~ bill_length_mm * species + flipper_length_mm"</span>, data <span class="op">=</span> penguins_pd).fit()</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>interacted.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>body_mass_g</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.826</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.823</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>265.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Wed, 03 Jul 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>4.07e-124</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>13:43:31</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-2472.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>342</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>4959.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>335</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>4985.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>6</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>-4297.9054</td>
<td>645.054</td>
<td>-6.663</td>
<td>0.000</td>
<td>-5566.772</td>
<td>-3029.039</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">species[T.Chinstrap]</td>
<td>1146.2869</td>
<td>726.217</td>
<td>1.578</td>
<td>0.115</td>
<td>-282.232</td>
<td>2574.806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">species[T.Gentoo]</td>
<td>54.7163</td>
<td>619.934</td>
<td>0.088</td>
<td>0.930</td>
<td>-1164.739</td>
<td>1274.171</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">bill_length_mm</td>
<td>72.6920</td>
<td>10.642</td>
<td>6.831</td>
<td>0.000</td>
<td>51.759</td>
<td>93.625</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">bill_length_mm:species[T.Chinstrap]</td>
<td>-41.0350</td>
<td>16.104</td>
<td>-2.548</td>
<td>0.011</td>
<td>-72.713</td>
<td>-9.357</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">bill_length_mm:species[T.Gentoo]</td>
<td>-1.1626</td>
<td>14.436</td>
<td>-0.081</td>
<td>0.936</td>
<td>-29.559</td>
<td>27.234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">flipper_length_mm</td>
<td>27.2632</td>
<td>3.175</td>
<td>8.586</td>
<td>0.000</td>
<td>21.017</td>
<td>33.509</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>4.761</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>2.272</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.093</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>4.564</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>0.279</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.102</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>3.098</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>1.01e+04</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 1.01e+04. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
</div>
</div>
</div>
<p>Again for whatever reason patsy does not have great support for polars dataframe so the original polars frame throws an error.</p>
<p>One thing that we generally want to do is check our OLS assumptions. There are lots of different tests that we can run. But a good first check is to look at the fitted values versus the residuals.</p>
<p>In R we can do</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(patchwork)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>dropped_nas <span class="ot">=</span> penguins <span class="sc">|&gt;</span> <span class="fu">drop_na</span>(sex)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>with_species <span class="ot">=</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> flipper_length_mm <span class="sc">+</span> species,</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dropped_nas)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>check_resids <span class="ot">=</span> <span class="fu">augment</span>(with_species, <span class="at">data =</span> dropped_nas)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>violation_one <span class="ot">=</span> <span class="fu">ggplot</span>(check_resids, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>violation_two <span class="ot">=</span> <span class="fu">ggplot</span>(check_resids, <span class="fu">aes</span>(<span class="at">x =</span> .resid)) <span class="sc">+</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>violation_one <span class="sc">+</span> violation_two </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In Python we would do something like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>penugins_pl <span class="op">=</span> pl.read_csv(<span class="st">'penguins.csv'</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>penguins_sans_na <span class="op">=</span> penguins.<span class="bu">filter</span>((pl.col(<span class="st">"sex"</span>).is_not_null())).to_pandas()</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>with_species <span class="op">=</span> smf.ols(<span class="st">'body_mass_g ~ bill_length_mm + flipper_length_mm + species'</span>, data <span class="op">=</span> penguins_sans_na).fit()</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>penguins_sans_na[<span class="st">'fitted_vals'</span>] <span class="op">=</span> with_species.fittedvalues</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>penguins_sans_na[<span class="st">'residuals'</span>] <span class="op">=</span> with_species.resid</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x <span class="op">=</span> <span class="st">"fitted_vals"</span>, y <span class="op">=</span> <span class="st">"residuals"</span>, hue <span class="op">=</span> <span class="st">"species"</span>, data <span class="op">=</span> penguins_sans_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="misc-stuff-that-are-usefull-but-not-neccessarilly-useful-all-the-time" class="level1">
<h1>Misc stuff that are usefull but not neccessarilly useful all the time</h1>
<p>Here are the collection of misfits that I thought would be useful</p>
<section id="slicefamily" class="level3">
<h3 class="anchored" data-anchor-id="slicefamily">Slice(family)</h3>
<p>One useful thing that I use all the time when testing out various things I am doing is using slice. This can be specific rows or a random sample of rows!</p>
<p>If we wanted specific rows we could do this with <code>slice</code></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(<span class="dv">90</span><span class="sc">:</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Dream            38.9          18.8               190        3600
 2 Adelie  Dream            35.7          18                 202        3550
 3 Adelie  Dream            41.1          18.1               205        4300
 4 Adelie  Dream            34            17.1               185        3400
 5 Adelie  Dream            39.6          18.1               186        4450
 6 Adelie  Dream            36.2          17.3               187        3300
 7 Adelie  Dream            40.8          18.9               208        4300
 8 Adelie  Dream            38.1          18.6               190        3700
 9 Adelie  Dream            40.3          18.5               196        4350
10 Adelie  Dream            33.1          16.1               178        2900
11 Adelie  Dream            43.2          18.5               192        4100
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>penguins.<span class="bu">slice</span>(<span class="dv">89</span>:<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>invalid syntax (&lt;string&gt;, line 1)</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>It looks like the R user in me strikes. So in polars if you wanted to do the same thing you give the starting number of the row you want and the length of the row you want. So we would rewrite the code like this</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(<span class="dv">90</span><span class="sc">:</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Dream            38.9          18.8               190        3600
 2 Adelie  Dream            35.7          18                 202        3550
 3 Adelie  Dream            41.1          18.1               205        4300
 4 Adelie  Dream            34            17.1               185        3400
 5 Adelie  Dream            39.6          18.1               186        4450
 6 Adelie  Dream            36.2          17.3               187        3300
 7 Adelie  Dream            40.8          18.9               208        4300
 8 Adelie  Dream            38.1          18.6               190        3700
 9 Adelie  Dream            40.3          18.5               196        4350
10 Adelie  Dream            33.1          16.1               178        2900
11 Adelie  Dream            43.2          18.5               192        4100
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>penguins.<span class="bu">slice</span>(<span class="dv">89</span>,<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AttributeError: 'DataFrame' object has no attribute 'slice'</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>I actually quite like the syntax of the python version better. It is just annoying having to reset my thinking to start counting at <code>0</code></p>
</section>
<section id="slice-sample" class="level3">
<h3 class="anchored" data-anchor-id="slice-sample">Slice Sample</h3>
<p>I find it useful to take a random sample of rows and test functions. It is nice for the function to work on a set of examples you come up with but not everything is consistent so lopping off chunks of a dataset and seeing if it still works is useful.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
   species   island   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;     &lt;fct&gt;             &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Chinstrap Dream              50.2          18.7               198        3775
 2 Adelie    Biscoe             39.7          18.9               184        3550
 3 Chinstrap Dream              45.4          18.7               188        3525
 4 Gentoo    Biscoe             46.2          14.1               217        4375
 5 Gentoo    Biscoe             50            16.3               230        5700
 6 Chinstrap Dream              49.8          17.3               198        3675
 7 Adelie    Biscoe             35            17.9               192        3725
 8 Adelie    Biscoe             40.6          18.6               183        3550
 9 Adelie    Torgers…           40.6          19                 199        4000
10 Chinstrap Dream              46.5          17.9               192        3500
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>penguins.sample(n <span class="op">=</span> <span class="dv">10</span>, seed <span class="op">=</span> <span class="dv">1994</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TypeError: sample() got an unexpected keyword argument 'seed'</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Luckily the syntax is broadly the same!</p>
</section>
<section id="batch-renaming" class="level3">
<h3 class="anchored" data-anchor-id="batch-renaming">Batch renaming</h3>
<p>Often times if we download data from the internet the column names are a mess and we want to rename them all at once. The janitor package in R is extra handy</p>
<p>Lets say we wanted to mass produce a camel case across the entire dataframe. In <code>R</code> that is a fairly simple task. Is it the case for python?</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">clean_names</span>(<span class="at">case =</span> <span class="st">"lower_camel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island billLengthMm billDepthMm flipperLengthMm bodyMassG sex    year
   &lt;fct&gt;   &lt;fct&gt;         &lt;dbl&gt;       &lt;dbl&gt;           &lt;int&gt;     &lt;int&gt; &lt;fct&gt; &lt;int&gt;
 1 Adelie  Torge…         39.1        18.7             181      3750 male   2007
 2 Adelie  Torge…         39.5        17.4             186      3800 fema…  2007
 3 Adelie  Torge…         40.3        18               195      3250 fema…  2007
 4 Adelie  Torge…         NA          NA                NA        NA &lt;NA&gt;   2007
 5 Adelie  Torge…         36.7        19.3             193      3450 fema…  2007
 6 Adelie  Torge…         39.3        20.6             190      3650 male   2007
 7 Adelie  Torge…         38.9        17.8             181      3625 fema…  2007
 8 Adelie  Torge…         39.2        19.6             195      4675 male   2007
 9 Adelie  Torge…         34.1        18.1             193      3475 &lt;NA&gt;   2007
10 Adelie  Torge…         42          20.2             190      4250 &lt;NA&gt;   2007
# ℹ 334 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> janitor <span class="im">import</span> clean_names</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> penguins.rename({<span class="st">"bill_length_mm"</span>: <span class="st">"BillLengthMm"</span>,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"bill_depth_mm"</span> : <span class="st">"BillDepthMm"</span>})</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>penguins.clean_names()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       species     island  bill_length_mm  ...  body_mass_g     sex  year
0       Adelie  Torgersen            39.1  ...       3750.0    male  2007
1       Adelie  Torgersen            39.5  ...       3800.0  female  2007
2       Adelie  Torgersen            40.3  ...       3250.0  female  2007
3       Adelie  Torgersen             NaN  ...          NaN     NaN  2007
4       Adelie  Torgersen            36.7  ...       3450.0  female  2007
..         ...        ...             ...  ...          ...     ...   ...
339  Chinstrap      Dream            55.8  ...       4000.0    male  2009
340  Chinstrap      Dream            43.5  ...       3400.0  female  2009
341  Chinstrap      Dream            49.6  ...       3775.0    male  2009
342  Chinstrap      Dream            50.8  ...       4100.0    male  2009
343  Chinstrap      Dream            50.2  ...       3775.0  female  2009

[344 rows x 8 columns]</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>In my head it looks like this. Where we are effectively chaining clean names to the dataframe. From the documentation it looks like this</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">clean_names</span>(<span class="at">case =</span> <span class="st">"small_camel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island billLengthMm billDepthMm flipperLengthMm bodyMassG sex    year
   &lt;fct&gt;   &lt;fct&gt;         &lt;dbl&gt;       &lt;dbl&gt;           &lt;int&gt;     &lt;int&gt; &lt;fct&gt; &lt;int&gt;
 1 Adelie  Torge…         39.1        18.7             181      3750 male   2007
 2 Adelie  Torge…         39.5        17.4             186      3800 fema…  2007
 3 Adelie  Torge…         40.3        18               195      3250 fema…  2007
 4 Adelie  Torge…         NA          NA                NA        NA &lt;NA&gt;   2007
 5 Adelie  Torge…         36.7        19.3             193      3450 fema…  2007
 6 Adelie  Torge…         39.3        20.6             190      3650 male   2007
 7 Adelie  Torge…         38.9        17.8             181      3625 fema…  2007
 8 Adelie  Torge…         39.2        19.6             195      4675 male   2007
 9 Adelie  Torge…         34.1        18.1             193      3475 &lt;NA&gt;   2007
10 Adelie  Torge…         42          20.2             190      4250 &lt;NA&gt;   2007
# ℹ 334 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>clean_names(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       species     island  bill_length_mm  ...  body_mass_g     sex  year
0       Adelie  Torgersen            39.1  ...       3750.0    male  2007
1       Adelie  Torgersen            39.5  ...       3800.0  female  2007
2       Adelie  Torgersen            40.3  ...       3250.0  female  2007
3       Adelie  Torgersen             NaN  ...          NaN     NaN  2007
4       Adelie  Torgersen            36.7  ...       3450.0  female  2007
..         ...        ...             ...  ...          ...     ...   ...
339  Chinstrap      Dream            55.8  ...       4000.0    male  2009
340  Chinstrap      Dream            43.5  ...       3400.0  female  2009
341  Chinstrap      Dream            49.6  ...       3775.0    male  2009
342  Chinstrap      Dream            50.8  ...       4100.0    male  2009
343  Chinstrap      Dream            50.2  ...       3775.0  female  2009

[344 rows x 8 columns]</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Okay the trick it looks like is that it does not work with polars objects. So we need to pass it to pandas and then back to polars.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>penguins.glimpse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 344
Columns: 8
$ species           &lt;str&gt; 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie'
$ island            &lt;str&gt; 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen'
$ bill_length_mm    &lt;str&gt; '39.1', '39.5', '40.3', 'NA', '36.7', '39.3', '38.9', '39.2', '34.1', '42'
$ bill_depth_mm     &lt;str&gt; '18.7', '17.4', '18', 'NA', '19.3', '20.6', '17.8', '19.6', '18.1', '20.2'
$ flipper_length_mm &lt;str&gt; '181', '186', '195', 'NA', '193', '190', '181', '195', '193', '190'
$ body_mass_g       &lt;str&gt; '3750', '3800', '3250', 'NA', '3450', '3650', '3625', '4675', '3475', '4250'
$ sex               &lt;str&gt; 'male', 'female', 'female', 'NA', 'female', 'male', 'female', 'male', 'NA', 'NA'
$ year              &lt;i64&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>penguins_pd <span class="op">=</span> penguins.to_pandas()</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>penguins_clean <span class="op">=</span> clean_names(penguins_pd, case_type <span class="op">=</span> <span class="st">"snake"</span>)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> pl.from_pandas(penguins_clean)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>penguins.glimpse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 344
Columns: 8
$ species           &lt;str&gt; 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie', 'Adelie'
$ island            &lt;str&gt; 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen', 'Torgersen'
$ bill_length_mm    &lt;str&gt; '39.1', '39.5', '40.3', 'NA', '36.7', '39.3', '38.9', '39.2', '34.1', '42'
$ bill_depth_mm     &lt;str&gt; '18.7', '17.4', '18', 'NA', '19.3', '20.6', '17.8', '19.6', '18.1', '20.2'
$ flipper_length_mm &lt;str&gt; '181', '186', '195', 'NA', '193', '190', '181', '195', '193', '190'
$ body_mass_g       &lt;str&gt; '3750', '3800', '3250', 'NA', '3450', '3650', '3625', '4675', '3475', '4250'
$ sex               &lt;str&gt; 'male', 'female', 'female', 'NA', 'female', 'male', 'female', 'male', 'NA', 'NA'
$ year              &lt;i64&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007</code></pre>
</div>
</div>
<p>This works which is awesome! We got back to the original dataset naes</p>
</section>
<section id="make-a-column-into-a-vector" class="level2">
<h2 class="anchored" data-anchor-id="make-a-column-into-a-vector">Make a column into a vector</h2>
<p>In R there are like a ton of different ways to do this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>vec1 <span class="ot">=</span> penguins<span class="sc">$</span>bill_depth_mm</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>vec2 <span class="ot">=</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pluck</span>(<span class="st">"bill_depth_mm"</span>)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>vec3 <span class="ot">=</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(bill_depth_mm) <span class="sc">|&gt;</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="fu">deframe</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In polars the equivalent of this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>vec1 <span class="op">=</span> penguins[<span class="st">"bill_depth_mm"</span>]</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vec1[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (2,)
Series: 'bill_depth_mm' [str]
[
    "18.7"
    "17.4"
]</code></pre>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>vec1[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18.7 17.4 18.0</code></pre>
</div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vec1[<span class="dv">0</span>:<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (2,)
Series: 'bill_depth_mm' [str]
[
    "18.7"
    "17.4"
]</code></pre>
</div>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/joshuafayallen\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>